/* Enhanced MedSpaSync Pro Demo with improved functionality */

(function() {

Â  'use strict';



Â  console.log('ðŸ¥ MedSpaSync Pro Demo - Enhanced Version');



Â  // Prevent multiple initialization

Â  if (window.MedSpaSyncDemo) {

Â  Â  console.warn('Demo already initialized');

Â  Â  return;

Â  }



Â  // Wait for DOM

Â  function ready(callback) {

Â  Â  if (document.readyState === 'loading') {

Â  Â  Â  document.addEventListener('DOMContentLoaded', callback);

Â  Â  } else {

Â  Â  Â  callback();

Â  Â  }

Â  }



Â  // Safe element getter with error handling

Â  function $(id) {

Â  Â  const element = document.getElementById(id);

Â  Â  if (!element) {

Â  Â  Â  console.warn(`Element #${id} not found`);

Â  Â  }

Â  Â  return element;

Â  }



Â  // Enhanced demo state

Â  const state = {

Â  Â  files: { pos: null, alle: null, aspire: null },

Â  Â  processing: false,

Â  Â  results: null,

Â  Â  currentStage: 0

Â  };



Â  // Enhanced sample data with more realistic content

Â  const sampleData = {

Â  Â  pos: `name,service,amount,date,provider

"Sarah Johnson","Botox Cosmetic",450.00,"2024-03-15","Dr. Smith"

"Michael Chen","Juvederm Ultra",650.00,"2024-03-15","Dr. Johnson"

"Jennifer Smith","Dysport",380.00,"2024-03-16","Dr. Smith"

"Robert Davis","Restylane Lyft",700.00,"2024-03-16","Dr. Johnson"

"Lisa Anderson","Botox Cosmetic",525.00,"2024-03-17","Dr. Smith"

"David Williams","CoolSculpting Elite",1200.00,"2024-03-17","Tech Sarah"

"Emma Thompson","JuvÃ©derm Voluma XC",800.00,"2024-03-18","Dr. Johnson"

"James Wilson","Laser Hair Removal",350.00,"2024-03-18","Tech Mike"`,



Â  Â  alle: `customer_name,product,points_redeemed,redemption_date,transaction_id

"Sarah M Johnson","Botox Cosmetic",90,"2024-03-15","ALL001"

"Michael C Chen","Juvederm Ultra",130,"2024-03-15","ALL002"

"Jenny Smith","Dysport",76,"2024-03-16","ALL003"

"Lisa A Anderson","Botox Cosmetic",105,"2024-03-17","ALL004"

"Emma Thompson","JuvÃ©derm Voluma XC",160,"2024-03-18","ALL005"`,



Â  Â  aspire: `member_name,treatment,reward_amount,transaction_date,account_id

"Robert J Davis","Restylane Lyft",140.00,"2024-03-16","ASP001"

"David R Williams","Radiesse",96.00,"2024-03-19","ASP002"

"Emma J Thompson","Belotero Balance",84.00,"2024-03-20","ASP003"

"James W Wilson","GentleYAG Laser",70.00,"2024-03-20","ASP004"`

Â  };



Â  // Show notification

Â  function notify(message, type = 'success') {

Â  Â  let container = $('notificationContainer');

Â  Â  if (!container) {

Â  Â  Â  container = document.createElement('div');

Â  Â  Â  container.id = 'notificationContainer';

Â  Â  Â  document.body.appendChild(container);

Â  Â  }



Â  Â  const notification = document.createElement('div');

Â  Â  notification.className = `notification ${type}`;

Â  Â  notification.textContent = message;

Â  Â  container.appendChild(notification);



Â  Â  setTimeout(() => notification.classList.add('show'), 100);

Â  Â  setTimeout(() => {

Â  Â  Â  notification.classList.remove('show');

Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  if (notification.parentNode) {

Â  Â  Â  Â  Â  notification.parentNode.removeChild(notification);

Â  Â  Â  Â  }

Â  Â  Â  }, 300);

Â  Â  }, 3000);



Â  Â  console.log(`${type.toUpperCase()}: ${message}`);

Â  }



Â  // Update file status

Â  function updateFileStatus(type, fileName, selected) {

Â  Â  const statusEl = $(`${type}StatusDisplay`);

Â  Â  const areaEl = $(`${type}UploadArea`);



Â  Â  if (statusEl) {

Â  Â  Â  statusEl.textContent = selected ? `âœ“ ${fileName}` : 'Click to select CSV/TXT file';

Â  Â  Â  statusEl.style.color = selected ? 'var(--accent-green)' : 'var(--neutral-500)';

Â  Â  }



Â  Â  if (areaEl) {

Â  Â  Â  areaEl.classList.toggle('selected', selected);

Â  Â  }

Â  }



Â  // Update button state

Â  function updateButton() {

Â  Â  const btn = $('startReconciliationBtn');

Â  Â  if (!btn) return;



Â  Â  const fileCount = Object.values(state.files).filter(f => f).length;

Â  Â  const allSelected = fileCount === 3;



Â  Â  btn.disabled = !allSelected;

Â  Â  btn.textContent = allSelected

Â  Â  Â  ? `ðŸš€ Begin AI Reconciliation Process`

Â  Â  Â  : `Select ${3 - fileCount} more file${3 - fileCount !== 1 ? 's' : ''} to continue`;

Â  }



Â  // Load sample data

Â  function loadSample(type) {

Â  Â  if (!sampleData[type]) return;



Â  Â  const mockFile = {

Â  Â  Â  name: `sample_${type}_data.csv`,

Â  Â  Â  size: sampleData[type].length,

Â  Â  Â  content: sampleData[type]

Â  Â  };



Â  Â  state.files[type] = mockFile;

Â  Â  updateFileStatus(type, mockFile.name, true);

Â  Â  updateButton();

Â  Â  notify(`Sample ${type.toUpperCase()} data loaded`);

Â  }



Â  // Handle file upload with enhanced drag and drop

Â  function handleFile(type, file) {

Â  Â  if (!file) return;



Â  Â  const validExts = ['.csv', '.txt'];

Â  Â  const ext = '.' + file.name.split('.').pop().toLowerCase();



Â  Â  if (!validExts.includes(ext)) {

Â  Â  Â  notify('Invalid file type. Please select CSV or TXT files.', 'error');

Â  Â  Â  return;

Â  Â  }



Â  Â  if (file.size > 10 * 1024 * 1024) {

Â  Â  Â  notify('File too large. Maximum size is 10MB.', 'error');

Â  Â  Â  return;

Â  Â  }



Â  Â  state.files[type] = file;

Â  Â  updateFileStatus(type, file.name, true);

Â  Â  updateButton();

Â  Â  notify(`${type.toUpperCase()} file uploaded successfully`);

Â  }



Â  // Show section with enhanced visual feedback

Â  function showSection(sectionId) {

Â  Â  const sections = ['uploadSection', 'processingSection', 'resultsSection'];

Â  Â  sections.forEach(id => {

Â  Â  Â  const el = $(id);

Â  Â  Â  if (el) {

Â  Â  Â  Â  el.classList.toggle('hidden', id !== sectionId);

Â  Â  Â  }

Â  Â  });

Â  Â  state.currentStage = sections.indexOf(sectionId);

Â  Â  updateProgressBar(0);

Â  }



Â  // Update progress bar

Â  function updateProgressBar(progress) {

Â  Â  const fill = $('progressFill');

Â  Â  if (fill) {

Â  Â  Â  fill.style.width = `${progress}%`;

Â  Â  }

Â  Â  const stages = ['stage1', 'stage2', 'stage3', 'stage4'];

Â  Â  stages.forEach((id, index) => {

Â  Â  Â  const el = $(id);

Â  Â  Â  if (el) {

Â  Â  Â  Â  el.classList.remove('active', 'completed');

Â  Â  Â  Â  if (index < state.currentStage) {

Â  Â  Â  Â  Â  el.classList.add('completed');

Â  Â  Â  Â  } else if (index === state.currentStage) {

Â  Â  Â  Â  Â  el.classList.add('active');

Â  Â  Â  Â  }

Â  Â  Â  }

Â  Â  });

Â  }



Â  // Animate counter with improved easing

Â  function animateCounter(elementId, target, suffix = '') {

Â  Â  const el = $(elementId);

Â  Â  if (!el) return;



Â  Â  const duration = 1500;

Â  Â  const start = performance.now();



Â  Â  function update() {

Â  Â  Â  const elapsed = performance.now() - start;

Â  Â  Â  const progress = Math.min(elapsed / duration, 1);

Â  Â  Â  const easedProgress = (t) => t * t * t * (t * (6 * t - 15) + 10); // Easing function

Â  Â  Â  const current = Math.floor(target * easedProgress(progress));



Â  Â  Â  el.textContent = current.toLocaleString() + suffix;



Â  Â  Â  if (progress < 1) {

Â  Â  Â  Â  requestAnimationFrame(update);

Â  Â  Â  }

Â  Â  }



Â  Â  requestAnimationFrame(update);

Â  }



Â  // Display results in an enhanced table

Â  function displayResults(results) {

Â  Â  showSection('resultsSection');



Â  Â  const subtitle = $('resultsSubtitle');

Â  Â  if (subtitle) {

Â  Â  Â  subtitle.innerHTML = `

Â  Â  Â  Â  Processed ${results.total} transactions in ${results.processingTime}s<br>

Â  Â  Â  Â  <span style="color: var(--accent-green); font-weight: 600;">Achieved ${results.accuracy}% accuracy</span>

Â  Â  Â  `;

Â  Â  }



Â  Â  animateCounter('totalTransactions', results.total);

Â  Â  animateCounter('exactMatches', results.exact);

Â  Â  animateCounter('fuzzyMatches', results.fuzzy);

Â  Â  animateCounter('accuracy', results.accuracy, '%');



Â  Â  const tbody = $('resultsTableBody');

Â  Â  if (tbody && results.matches) {

Â  Â  Â  tbody.innerHTML = results.matches.map(match => `

Â  Â  Â  Â  <tr>

Â  Â  Â  Â  Â  <td style="font-weight: 500;">${match.name}</td>

Â  Â  Â  Â  Â  <td>${match.service}</td>

Â  Â  Â  Â  Â  <td>${match.date}</td>

Â  Â  Â  Â  Â  <td style="text-align: right; font-weight: 500;">$${match.amount.toFixed(2)}</td>

Â  Â  Â  Â  Â  <td>

Â  Â  Â  Â  Â  Â  <span class="badge-match badge-${match.type}">

Â  Â  Â  Â  Â  Â  Â  ${match.type.charAt(0).toUpperCase() + match.type.slice(1)}

Â  Â  Â  Â  Â  Â  </span>

Â  Â  Â  Â  Â  </td>

Â  Â  Â  Â  Â  <td>

Â  Â  Â  Â  Â  Â  <span class="badge-match ${match.confidence >= 90 ? 'badge-exact' : (match.confidence >= 70 ? 'badge-fuzzy' : '')}">

Â  Â  Â  Â  Â  Â  Â  ${match.confidence}%

Â  Â  Â  Â  Â  Â  </span>

Â  Â  Â  Â  Â  </td>

Â  Â  Â  Â  </tr>

Â  Â  Â  `).join('');

Â  Â  }



Â  Â  notify('Reconciliation completed successfully!');

Â  }



Â  // Simulate advanced reconciliation process with progress updates

Â  async function startReconciliation() {

Â  Â  if (state.processing) {

Â  Â  Â  notify('Already processing...', 'error');

Â  Â  Â  return;

Â  Â  }



Â  Â  const files = state.files;

Â  Â  if (!files.pos || !files.alle || !files.aspire) {

Â  Â  Â  notify('Please select all three files first', 'error');

Â  Â  Â  return;

Â  Â  }



Â  Â  state.processing = true;

Â  Â  showSection('processingSection');

Â  Â  state.currentStage = 1;

Â  Â  updateProgressBar(20);



Â  Â  await new Promise(resolve => setTimeout(resolve, 1500));

Â  Â  state.currentStage = 2;

Â  Â  updateProgressBar(50);



Â  Â  await new Promise(resolve => setTimeout(resolve, 2000));

Â  Â  state.currentStage = 3;

Â  Â  updateProgressBar(80);



Â  Â  await new Promise(resolve => setTimeout(resolve, 1000));

Â  Â  state.currentStage = 4;

Â  Â  updateProgressBar(100);



Â  Â  try {

Â  Â  Â  const total = 10;

Â  Â  Â  const exact = 7;

Â  Â  Â  const fuzzy = 2;

Â  Â  Â  const accuracy = Math.round(((exact + fuzzy) / total) * 100);



Â  Â  Â  const results = {

Â  Â  Â  Â  total,

Â  Â  Â  Â  exact,

Â  Â  Â  Â  fuzzy,

Â  Â  Â  Â  accuracy,

Â  Â  Â  Â  processingTime: 4.5,

Â  Â  Â  Â  matches: [

Â  Â  Â  Â  Â  { name: "Sarah Johnson", service: "Botox Cosmetic", date: "2024-03-15", amount: 450.00, type: "exact", confidence: 98 },

Â  Â  Â  Â  Â  { name: "Michael Chen", service: "Juvederm Ultra", date: "2024-03-15", amount: 650.00, type: "exact", confidence: 99 },

Â  Â  Â  Â  Â  { name: "Jennifer Smith", service: "Dysport", date: "2024-03-16", amount: 380.00, type: "fuzzy", confidence: 87 },

Â  Â  Â  Â  Â  { name: "Robert Davis", service: "Restylane Lyft", date: "2024-03-16", amount: 700.00, type: "exact", confidence: 96 },

Â  Â  Â  Â  Â  { name: "Lisa Anderson", service: "Botox Cosmetic", date: "2024-03-17", amount: 525.00, type: "exact", confidence: 97 },

Â  Â  Â  Â  Â  { name: "David Williams", service: "CoolSculpting Elite", date: "2024-03-17", amount: 1200.00, type: "fuzzy", confidence: 82 },

Â  Â  Â  Â  Â  { name: "Emma Thompson", service: "JuvÃ©derm Voluma XC", date: "2024-03-18", amount: 800.00, type: "exact", confidence: 95 }

Â  Â  Â  Â  ]

Â  Â  Â  };

Â  Â  Â  state.results = results;

Â  Â  Â  displayResults(results);



Â  Â  } catch (error) {

Â  Â  Â  console.error('Processing error:', error);

Â  Â  Â  notify('Processing failed. Please try again.', 'error');

Â  Â  Â  showSection('uploadSection');

Â  Â  } finally {

Â  Â  Â  state.processing = false;

Â  Â  }

Â  }



Â  // Export results to CSV with more detailed content

Â  function exportResults() {

Â  Â  if (!state.results) {

Â  Â  Â  notify('No results to export', 'error');

Â  Â  Â  return;

Â  Â  }



Â  Â  const csvRows = [

Â  Â  Â  ['MedSpaSync Pro Reconciliation Report'],

Â  Â  Â  [`Generated: ${new Date().toISOString()}`],

Â  Â  Â  [`Total Transactions: ${state.results.total}`],

Â  Â  Â  [`Accuracy: ${state.results.accuracy}%`],

Â  Â  Â  [''],

Â  Â  Â  ['Customer Name', 'Service', 'Date', 'Amount', 'Match Type', 'Confidence']

Â  Â  ];



Â  Â  state.results.matches.forEach(match => {

Â  Â  Â  csvRows.push([match.name, match.service, match.date, match.amount.toFixed(2), match.type, `${match.confidence}%`]);

Â  Â  });



Â  Â  const csvContent = csvRows.map(row => row.join(',')).join('\n');

Â  Â  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

Â  Â  const url = URL.createObjectURL(blob);

Â  Â  const link = document.createElement('a');

Â  Â  link.href = url;

Â  Â  link.download = 'medspasync_reconciliation_report.csv';

Â  Â  document.body.appendChild(link);

Â  Â  link.click();

Â  Â  document.body.removeChild(link);

Â  Â  URL.revokeObjectURL(url);

Â  Â  notify('Report exported to CSV!');

Â  }



Â  ready(() => {

Â  Â  console.log('Demo is ready!');

Â  Â  window.MedSpaSyncDemo = true;



Â  Â  const posUpload = $('posFileInput');

Â  Â  const alleUpload = $('alleFileInput');

Â  Â  const aspireUpload = $('aspireFileInput');

Â  Â  const loadPosSample = $('loadPosSampleBtn');

Â  Â  const loadAlleSample = $('loadAlleSampleBtn');

Â  Â  const loadAspireSample = $('loadAspireSampleBtn');

Â  Â  const startBtn = $('startReconciliationBtn');

Â  Â  const exportBtn = $('exportReportBtn');

Â  Â  const posArea = $('posUploadArea');

Â  Â  const alleArea = $('alleUploadArea');

Â  Â  const aspireArea = $('aspireUploadArea');



Â  Â  if (posUpload) posUpload.addEventListener('change', (e) => handleFile('pos', e.target.files[0]));

Â  Â  if (alleUpload) alleUpload.addEventListener('change', (e) => handleFile('alle', e.target.files[0]));

Â  Â  if (aspireUpload) aspireUpload.addEventListener('change', (e) => handleFile('aspire', e.target.files[0]));

Â  Â  if (loadPosSample) loadPosSample.addEventListener('click', () => loadSample('pos'));

Â  Â  if (loadAlleSample) loadAlleSample.addEventListener('click', () => loadSample('alle'));

Â  Â  if (loadAspireSample) loadAspireSample.addEventListener('click', () => loadSample('aspire'));

Â  Â  if (startBtn) startBtn.addEventListener('click', startReconciliation);

Â  Â  if (exportBtn) exportBtn.addEventListener('click', exportResults);



Â  Â  // Enhanced drag and drop functionality

Â  Â  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {

Â  Â  Â  posArea?.addEventListener(eventName, (e) => {

Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  if (eventName === 'dragover') posArea.classList.add('dragover');

Â  Â  Â  Â  if (eventName === 'dragleave' || eventName === 'drop') posArea.classList.remove('dragover');

Â  Â  Â  });

Â  Â  Â  alleArea?.addEventListener(eventName, (e) => {

Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  if (eventName === 'dragover') alleArea.classList.add('dragover');

Â  Â  Â  Â  if (eventName === 'dragleave' || eventName === 'drop') alleArea.classList.remove('dragover');

Â  Â  Â  });

Â  Â  Â  aspireArea?.addEventListener(eventName, (e) => {

Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  if (eventName === 'dragover') aspireArea.classList.add('dragover');

Â  Â  Â  Â  if (eventName === 'dragleave' || eventName === 'drop') aspireArea.classList.remove('dragover');

Â  Â  Â  });

Â  Â  });



Â  Â  if (posArea) posArea.addEventListener('drop', (e) => handleFile('pos', e.dataTransfer.files[0]));

Â  Â  if (alleArea) alleArea.addEventListener('drop', (e) => handleFile('alle', e.dataTransfer.files[0]));

Â  Â  if (aspireArea) aspireArea.addEventListener('drop', (e) => handleFile('aspire', e.dataTransfer.files[0]));



Â  Â  updateButton();

Â  });

})();