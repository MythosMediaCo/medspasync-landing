<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Experience enterprise-grade medical spa reconciliation that finds lost revenue in seconds. Try our live demo with real AI-powered matching.">
  <meta name="theme-color" content="#1e40af">
  <meta name="robots" content="index, follow">
  
  <!-- Performance optimizations -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- SEO and Social -->
  <title>MedSpaSync Pro - AI-Powered Revenue Recovery Demo</title>
  <meta property="og:title" content="MedSpaSync Pro - AI Revenue Recovery Demo">
  <meta property="og:description" content="See how AI finds missing revenue in your medical spa transactions. Live demo with real matching capabilities.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://demo.medspasyncpro.com">
  <meta name="twitter:card" content="summary_large_image">
  
  <!-- Security -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self';">
  
  <style>
    /* Critical CSS - Above the fold styles */
    :root {
      --primary-blue: #1e40af;
      --primary-blue-hover: #1d4ed8;
      --primary-blue-light: #3b82f6;
      --accent-green: #059669;
      --accent-green-hover: #047857;
      --accent-purple: #7c3aed;
      --warning: #f59e0b;
      --error: #ef4444;
      --success: #10b981;
      --neutral-50: #f8fafc;
      --neutral-100: #f1f5f9;
      --neutral-200: #e2e8f0;
      --neutral-300: #cbd5e1;
      --neutral-400: #94a3b8;
      --neutral-500: #64748b;
      --neutral-600: #475569;
      --neutral-700: #334155;
      --neutral-800: #1e293b;
      --neutral-900: #0f172a;
      --white: #ffffff;
      --gradient-brand: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
      --gradient-success: linear-gradient(135deg, var(--accent-green), #10b981);
      --gradient-warning: linear-gradient(135deg, var(--warning), #fbbf24);
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      --transition-fast: 150ms ease;
      --transition-base: 300ms ease;
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --radius-2xl: 24px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(180deg, var(--neutral-50) 0%, var(--white) 100%);
      min-height: 100vh;
      color: var(--neutral-800);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Loading state */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 300ms ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--neutral-200);
      border-top-color: var(--primary-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Navigation */
    .nav {
      background: var(--white);
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 50;
      border-bottom: 1px solid var(--neutral-200);
    }

    .nav-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--space-md) var(--space-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 32px;
      height: 32px;
      background: var(--gradient-brand);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      flex-shrink: 0;
    }

    .logo-text {
      font-size: var(--font-size-lg);
      font-weight: 700;
      color: var(--neutral-900);
    }

    .demo-badge {
      background: #dcfce7;
      color: #166534;
      padding: var(--space-xs) var(--space-sm);
      border-radius: 9999px;
      font-size: var(--font-size-xs);
      font-weight: 600;
      border: 1px solid #bbf7d0;
    }

    /* Main layout */
    .main {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--space-xl) var(--space-lg);
    }

    .section {
      margin-bottom: var(--space-2xl);
    }

    .section-center {
      text-align: center;
    }

    .hero-title {
      font-size: var(--font-size-3xl);
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: var(--space-md);
    }

    .hero-subtitle {
      font-size: var(--font-size-lg);
      color: var(--neutral-600);
      margin-bottom: var(--space-lg);
    }

    /* Buttons */
    .btn {
      border: none;
      border-radius: var(--radius-lg);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-base);
      font-size: var(--font-size-base);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      text-decoration: none;
      min-height: 44px;
      padding: var(--space-md) var(--space-lg);
      position: relative;
      overflow: hidden;
    }

    .btn:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      transform: none !important;
    }

    .btn-primary {
      background: var(--gradient-brand);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-success {
      background: var(--gradient-success);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .btn-success:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }

    .btn-full {
      width: 100%;
    }

    /* Cards */
    .card {
      background: var(--white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--neutral-200);
      padding: var(--space-lg);
      transition: all var(--transition-base);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    /* Form elements */
    .form {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .form-label {
      font-weight: 600;
      color: var(--neutral-700);
      font-size: var(--font-size-sm);
    }

    .form-input {
      padding: var(--space-md);
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-md);
      font-size: var(--font-size-base);
      transition: all var(--transition-fast);
      background: var(--white);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }

    .form-help {
      font-size: var(--font-size-xs);
      color: var(--neutral-500);
    }

    .form-error {
      font-size: var(--font-size-xs);
      color: var(--error);
      font-weight: 500;
    }

    /* Utility classes */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .hidden { 
      display: none !important; 
    }

    .text-center { 
      text-align: center; 
    }

    .max-w-md { 
      max-width: 28rem; 
      margin-left: auto; 
      margin-right: auto; 
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .nav-content {
        padding: var(--space-sm) var(--space-md);
        flex-direction: column;
        gap: var(--space-md);
      }

      .main {
        padding: var(--space-lg) var(--space-md);
      }

      .hero-title {
        font-size: var(--font-size-2xl);
      }
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    @media (prefers-contrast: high) {
      :root {
        --neutral-200: #999999;
        --neutral-300: #777777;
        --neutral-500: #333333;
      }
    }
  </style>
</head>
<body>
  <!-- Loading screen -->
  <div class="loading-screen" id="loadingScreen" aria-hidden="true">
    <div class="spinner" role="status" aria-label="Loading demo"></div>
  </div>

  <!-- Skip to main content for accessibility -->
  <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary-blue text-white p-2 rounded">
    Skip to main content
  </a>

  <!-- Navigation -->
  <nav class="nav" role="banner">
    <div class="nav-content">
      <div class="logo-section">
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
        </div>
        <span class="logo-text">MedSpaSync Pro</span>
        <span class="demo-badge">Demo 3.0</span>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main" id="main">
    <!-- Hero Section -->
    <section class="section section-center">
      <h1 class="hero-title">See your missing revenue in real time</h1>
      <p class="hero-subtitle">Upload a few sample files and watch AI find the matches instantly.</p>
      <button id="heroCtaBtn" 
              class="btn btn-primary" 
              aria-describedby="hero-cta-description">
        🚀 Start Revenue Recovery Demo
      </button>
      <div id="hero-cta-description" class="sr-only">
        Begin the interactive demo to see how MedSpaSync Pro finds missing revenue in your medical spa transactions
      </div>
    </section>

    <!-- Lead Capture Section -->
    <section id="leadCapture" class="section">
      <div class="max-w-md">
        <div class="card">
          <div class="text-center" style="margin-bottom: var(--space-lg);">
            <h2 style="font-size: var(--font-size-xl); font-weight: 700; margin-bottom: var(--space-sm);">
              Try the Demo
            </h2>
            <p style="color: var(--neutral-600);">
              Enter your email to access the full demo with real reconciliation capabilities
            </p>
          </div>

          <form id="leadForm" class="form" novalidate>
            <div class="form-group">
              <label for="leadEmail" class="form-label">Work Email</label>
              <input 
                id="leadEmail" 
                type="email" 
                required 
                class="form-input"
                placeholder="you@yourmedspa.com"
                aria-describedby="email-help email-error"
                autocomplete="email"
              >
              <div id="email-help" class="form-help">We'll never share your email or send spam</div>
              <div id="email-error" class="form-error hidden" role="alert"></div>
            </div>
            
            <div class="form-group">
              <label for="leadName" class="form-label">
                Name <span style="color: var(--neutral-400); font-weight: 400;">(optional)</span>
              </label>
              <input 
                id="leadName" 
                type="text" 
                class="form-input"
                placeholder="Your name"
                autocomplete="name"
              >
            </div>
            
            <button type="submit" class="btn btn-primary btn-full" aria-describedby="lead-submit-status">
              <span id="leadSubmitText">🚀 Start Demo</span>
              <span class="loading hidden" aria-hidden="true"></span>
            </button>
            
            <p id="leadNotice" class="text-center form-help hidden" role="status"></p>
            <div id="lead-submit-status" class="sr-only">Submit form to begin demo experience</div>
          </form>
        </div>
      </div>
    </section>

    <!-- Demo Tool Section -->
    <section id="demoTool" class="section hidden">
      <div class="text-center" style="margin-bottom: var(--space-xl);">
        <h2 style="font-size: var(--font-size-2xl); font-weight: 700; margin-bottom: var(--space-sm);">
          AI Revenue Recovery Demo
        </h2>
        <p style="color: var(--neutral-600);">
          Upload your CSV files and watch our AI find missing revenue matches
        </p>
      </div>

      <!-- Simple file upload interface -->
      <div class="card" style="margin-bottom: var(--space-xl);">
        <div style="text-align: center; margin-bottom: var(--space-lg);">
          <h3 style="font-size: var(--font-size-lg); font-weight: 600; margin-bottom: var(--space-sm);">
            Upload Your Files
          </h3>
          <p style="color: var(--neutral-600); font-size: var(--font-size-sm);">
            Upload POS, Allé, or Aspire CSV files to see AI-powered reconciliation in action
          </p>
        </div>

        <div id="uploadArea" 
             class="upload-area"
             style="border: 2px dashed var(--neutral-300); border-radius: var(--radius-lg); padding: var(--space-xl); text-align: center; cursor: pointer; transition: all var(--transition-base); background: var(--neutral-50);"
             tabindex="0"
             role="button"
             aria-label="Upload CSV files or drag and drop here">
          <div style="font-size: 3rem; margin-bottom: var(--space-md);" aria-hidden="true">📊</div>
          <div style="font-size: var(--font-size-lg); font-weight: 600; margin-bottom: var(--space-sm); color: var(--neutral-700);">
            Drop your CSV files here or click to browse
          </div>
          <div style="color: var(--neutral-500); font-size: var(--font-size-sm);">
            Supports POS, Allé, and Aspire data files
          </div>
        </div>

        <input type="file" 
               id="fileInput" 
               accept=".csv" 
               multiple
               class="hidden"
               aria-describedby="upload-help">
        
        <div id="upload-help" class="sr-only">
          Upload CSV files containing transaction data from your POS system, Allé rewards, or Aspire loyalty program
        </div>

        <div style="margin-top: var(--space-lg); text-align: center;">
          <button type="button" 
                  id="loadSampleBtn" 
                  class="btn"
                  style="background: var(--white); color: var(--neutral-700); border: 1px solid var(--neutral-300); margin-right: var(--space-md);">
            📁 Load Sample Data
          </button>
          <button id="runDemoBtn" 
                  class="btn btn-success" 
                  disabled
                  aria-describedby="run-demo-help">
            <span id="runDemoText">Upload files to run reconciliation</span>
            <span id="runLoader" class="loading hidden" aria-hidden="true"></span>
          </button>
        </div>

        <div id="run-demo-help" class="form-help" style="text-align: center; margin-top: var(--space-md);">
          Upload at least one CSV file to begin AI-powered reconciliation analysis
        </div>
      </div>

      <!-- File Preview -->
      <div id="filePreview" class="card hidden" style="margin-bottom: var(--space-xl);">
        <h3 style="font-size: var(--font-size-lg); font-weight: 600; margin-bottom: var(--space-md);">
          Files Ready for Processing
        </h3>
        <div id="fileList" class="file-list"></div>
      </div>

      <!-- Results Section -->
      <div id="results" class="hidden" role="region" aria-live="polite" aria-label="Reconciliation results">
        <div class="card">
          <div class="text-center" style="margin-bottom: var(--space-lg);">
            <h2 style="font-size: var(--font-size-2xl); font-weight: 700; margin-bottom: var(--space-sm);">
              Reconciliation Complete! 🎉
            </h2>
            <p id="resultsSubtitle" style="color: var(--neutral-600);">
              Processing completed successfully
            </p>
          </div>

          <div class="results-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-lg); margin: var(--space-xl) 0;">
            <div class="stat-card" style="background: var(--white); border: 1px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-lg); text-align: center;">
              <div id="totalTransactions" class="stat-number" style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--primary-blue); margin-bottom: var(--space-sm);">0</div>
              <div class="stat-label" style="color: var(--neutral-500); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600;">Total Transactions</div>
            </div>
            <div class="stat-card" style="background: var(--white); border: 1px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-lg); text-align: center;">
              <div id="exactMatches" class="stat-number" style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--success); margin-bottom: var(--space-sm);">0</div>
              <div class="stat-label" style="color: var(--neutral-500); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600;">Exact Matches</div>
            </div>
            <div class="stat-card" style="background: var(--white); border: 1px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-lg); text-align: center;">
              <div id="fuzzyMatches" class="stat-number" style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--accent-purple); margin-bottom: var(--space-sm);">0</div>
              <div class="stat-label" style="color: var(--neutral-500); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600;">AI Fuzzy Matches</div>
            </div>
            <div class="stat-card" style="background: var(--white); border: 1px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-lg); text-align: center;">
              <div id="matchAccuracy" class="stat-number" style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--accent-green); margin-bottom: var(--space-sm);">0%</div>
              <div class="stat-label" style="color: var(--neutral-500); font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600;">Match Accuracy</div>
            </div>
          </div>

          <div class="text-center" style="margin-top: var(--space-xl);">
            <button id="exportBtn" 
                    class="btn"
                    style="background: var(--white); color: var(--neutral-700); border: 1px solid var(--neutral-300); margin-right: var(--space-md);">
              📄 Export Results
            </button>
            <button id="startOverBtn" 
                    class="btn"
                    style="background: var(--gradient-warning); color: white;">
              🔄 Start Over
            </button>
          </div>

          <div class="text-center" style="margin-top: var(--space-lg);">
            <p style="color: var(--neutral-600); font-size: var(--font-size-sm);">
              🎯 <strong>Ready to get started?</strong> This demo shows real capabilities with your data.
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast Container -->
  <div id="toast" 
       class="toast-container" 
       style="position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: var(--space-sm); max-width: 400px;"
       aria-live="polite" 
       aria-atomic="true"></div>

  <!-- Footer -->
  <footer style="border-top: 1px solid var(--neutral-200); padding: var(--space-lg) 0; text-align: center; color: var(--neutral-500); font-size: var(--font-size-sm); margin-top: var(--space-2xl);">
    <div style="max-width: 1200px; margin: 0 auto; padding: 0 var(--space-lg);">
      © 2025 MedSpaSync Pro. Data is processed securely and never shared. • 
      <a href="#privacy" style="color: var(--primary-blue); text-decoration: underline;">Privacy Policy</a> • 
      <a href="#terms" style="color: var(--primary-blue); text-decoration: underline;">Terms of Service</a>
    </div>
  </footer>

  <!-- Non-critical CSS loaded asynchronously -->
  <style>
    /* Additional styles for upload area interactions */
    .upload-area:hover {
      border-color: var(--primary-blue);
      background: #eff6ff;
      transform: translateY(-2px);
    }

    .upload-area.dragover {
      border-color: var(--accent-green);
      background: #f0fdf4;
      transform: scale(1.02);
    }

    .upload-area.has-files {
      border-color: var(--success);
      border-style: solid;
      background: #f0fdf4;
    }

    /* File list styling */
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-md);
      background: var(--neutral-50);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-sm);
      border: 1px solid var(--neutral-200);
    }

    .file-item:last-child {
      margin-bottom: 0;
    }

    .file-info {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .file-icon {
      width: 24px;
      height: 24px;
      background: var(--success);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: var(--font-size-xs);
      font-weight: 700;
    }

    .file-details {
      display: flex;
      flex-direction: column;
    }

    .file-name {
      font-weight: 600;
      color: var(--neutral-900);
      font-size: var(--font-size-sm);
    }

    .file-size {
      color: var(--neutral-500);
      font-size: var(--font-size-xs);
    }

    /* Toast styling */
    .toast {
      background: var(--white);
      border: 1px solid var(--neutral-200);
      border-radius: var(--radius-lg);
      padding: var(--space-md) var(--space-lg);
      box-shadow: var(--shadow-xl);
      opacity: 0;
      transform: translateX(100%) scale(0.95);
      transition: all var(--transition-base);
      display: flex;
      align-items: center;
      gap: var(--space-md);
      border-left: 4px solid var(--neutral-300);
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0) scale(1);
    }

    .toast.success { border-left-color: var(--success); }
    .toast.error { border-left-color: var(--error); }
    .toast.warning { border-left-color: var(--warning); }
    .toast.info { border-left-color: var(--primary-blue); }

    .toast-content {
      flex: 1;
      font-size: var(--font-size-sm);
      color: var(--neutral-600);
      font-weight: 500;
    }

    /* Loading animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid var(--neutral-200);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s ease-in-out infinite;
    }

    /* Progress bar */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--neutral-200);
      border-radius: var(--radius-sm);
      overflow: hidden;
      margin: var(--space-md) 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-brand);
      border-radius: var(--radius-sm);
      transition: width 300ms ease;
      width: 0%;
    }

    /* Responsive enhancements */
    @media (max-width: 640px) {
      .results-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      
      .toast-container {
        left: var(--space-md);
        right: var(--space-md);
        max-width: none;
      }
    }
  </style>

  <script>
    /**
     * MedSpaSync Pro Demo 3.0 - Optimized Version
     * Enhanced performance, accessibility, and maintainability
     */
    (function() {
      'use strict';

      // Configuration
      const CONFIG = {
        MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
        VALID_EXTENSIONS: ['.csv'],
        TOAST_DURATION: 4000,
        SAMPLE_DATA: {
          pos: `name,service,amount,date,provider
"Sarah Johnson","Botox Cosmetic",450.00,"2024-03-15","Dr. Smith"
"Michael Chen","Juvederm Ultra",650.00,"2024-03-15","Dr. Johnson"
"Jennifer Smith","Dysport",380.00,"2024-03-16","Dr. Smith"
"Robert Davis","Restylane Lyft",700.00,"2024-03-16","Dr. Johnson"
"Lisa Anderson","Botox Cosmetic",525.00,"2024-03-17","Dr. Smith"`,
          
          alle: `customer_name,product,points_redeemed,redemption_date
"Sarah M Johnson","Botox Cosmetic",90,"2024-03-15"
"Michael C Chen","Juvederm Ultra",130,"2024-03-15"
"Jenny Smith","Dysport",76,"2024-03-16"
"Lisa A Anderson","Botox Cosmetic",105,"2024-03-17"`,
          
          aspire: `member_name,treatment,reward_amount,transaction_date
"Robert J Davis","Restylane Lyft",140.00,"2024-03-16"
"David Williams","Radiesse",96.00,"2024-03-19"`
        }
      };

      // State management
      const state = {
        currentStep: 'hero',
        userEmail: null,
        userName: null,
        files: [],
        processing: false,
        results: null,
        toasts: new Map()
      };

      // Utility functions
      const $ = (id) => document.getElementById(id);
      const $ = (selector) => document.querySelectorAll(selector);

      const utils = {
        // Safe execution wrapper
        safeExecute(fn, context = 'function') {
          try {
            return fn();
          } catch (error) {
            console.error(`Error in ${context}:`, error);
            this.showToast('An error occurred. Please try again.', 'error');
            return null;
          }
        },

        // Email validation
        validateEmail(email) {
          const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return re.test(email);
        },

        // Format file size
        formatFileSize(bytes) {
          if (bytes === 0) return '0 Bytes';
          const k = 1024;
          const sizes = ['Bytes', 'KB', 'MB', 'GB'];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        },

        // Get URL parameter
        getUrlParameter(name) {
          name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
          const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
          const results = regex.exec(location.search);
          return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        },

        // Announce to screen readers
        announceToScreenReader(message) {
          const announcement = document.createElement('div');
          announcement.setAttribute('aria-live', 'polite');
          announcement.setAttribute('aria-atomic', 'true');
          announcement.className = 'sr-only';
          announcement.textContent = message;
          
          document.body.appendChild(announcement);
          
          setTimeout(() => {
            if (announcement.parentNode) {
              document.body.removeChild(announcement);
            }
          }, 1000);
        },

        // Show toast notification
        showToast(message, type = 'info', duration = CONFIG.TOAST_DURATION) {
          const toastId = Date.now() + Math.random();
          const container = $('toast');
          
          if (!container) {
            console.log(`${type.toUpperCase()}: ${message}`);
            return null;
          }
          
          const toast = document.createElement('div');
          toast.className = `toast ${type}`;
          toast.setAttribute('role', type === 'error' ? 'alert' : 'status');
          toast.innerHTML = `<div class="toast-content">${message}</div>`;

          container.appendChild(toast);
          state.toasts.set(toastId, toast);

          // Animate in
          requestAnimationFrame(() => {
            toast.classList.add('show');
          });

          // Auto remove
          setTimeout(() => this.removeToast(toastId), duration);

          return toastId;
        },

        // Remove toast
        removeToast(toastId) {
          const toast = state.toasts.get(toastId);
          if (toast && toast.parentNode) {
            toast.classList.remove('show');
            setTimeout(() => {
              if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
              }
              state.toasts.delete(toastId);
            }, 300);
          }
        }
      };

      // Section management
      const sections = {
        show(sectionName) {
          return utils.safeExecute(() => {
            const sectionsToHide = ['leadCapture', 'demoTool'];
            
            sectionsToHide.forEach(section => {
              const el = $(section);
              if (el) el.classList.add('hidden');
            });

            const targetSection = $(sectionName);
            if (targetSection) {
              targetSection.classList.remove('hidden');
              targetSection.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
              });
            }

            state.currentStep = sectionName;
            utils.announceToScreenReader(`Switched to ${sectionName} section`);
          }, 'sections.show');
        }
      };

      // Form handling
      const forms = {
        // Show field error
        showError(fieldId, message) {
          const errorEl = $(`${fieldId}-error`);
          const inputEl = $(fieldId);
          
          if (errorEl) {
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
          }
          
          if (inputEl) {
            inputEl.setAttribute('aria-invalid', 'true');
            inputEl.style.borderColor = 'var(--error)';
            inputEl.focus();
          }
        },

        // Clear field error
        clearError(fieldId) {
          const errorEl = $(`${fieldId}-error`);
          const inputEl = $(fieldId);
          
          if (errorEl) {
            errorEl.classList.add('hidden');
          }
          
          if (inputEl) {
            inputEl.setAttribute('aria-invalid', 'false');
            inputEl.style.borderColor = '';
          }
        },

        // Submit lead form
        async submitLead(formData) {
          try {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            state.userEmail = formData.email;
            state.userName = formData.name;

            const notice = $('leadNotice');
            if (notice) {
              notice.textContent = 'Welcome! Demo access granted.';
              notice.style.color = 'var(--success)';
              notice.classList.remove('hidden');
            }

            utils.showToast('Welcome! Demo access granted.', 'success');
            utils.announceToScreenReader('Demo access granted. You can now upload files to test reconciliation.');
            
            setTimeout(() => {
              sections.show('demoTool');
            }, 1500);
            
          } catch (error) {
            console.error('Lead submission error:', error);
            utils.showToast('Failed to submit. Please try again.', 'error');
          }
        }
      };

      // File handling
      const files = {
        // Validate file
        validateFile(file) {
          const ext = '.' + file.name.split('.').pop().toLowerCase();
          
          if (!CONFIG.VALID_EXTENSIONS.includes(ext)) {
            utils.showToast('Invalid file type. Please select CSV files.', 'error');
            return false;
          }

          if (file.size > CONFIG.MAX_FILE_SIZE) {
            utils.showToast('File too large. Maximum size is 10MB.', 'error');
            return false;
          }

          return true;
        },

        // Add file to state
        addFile(file) {
          if (!this.validateFile(file)) return;

          const fileData = {
            id: Date.now() + Math.random(),
            name: file.name,
            size: file.size,
            type: this.detectFileType(file.name),
            file: file
          };

          state.files.push(fileData);
          this.updateUI();
          utils.showToast(`${file.name} uploaded successfully`, 'success');
        },

        // Detect file type from name
        detectFileType(filename) {
          const name = filename.toLowerCase();
          if (name.includes('pos') || name.includes('transaction')) return 'POS';
          if (name.includes('alle')) return 'Allé';
          if (name.includes('aspire')) return 'Aspire';
          return 'Unknown';
        },

        // Load sample data
        loadSampleData() {
          const sampleFiles = [
            { name: 'sample_pos_data.csv', type: 'POS', content: CONFIG.SAMPLE_DATA.pos },
            { name: 'sample_alle_data.csv', type: 'Allé', content: CONFIG.SAMPLE_DATA.alle },
            { name: 'sample_aspire_data.csv', type: 'Aspire', content: CONFIG.SAMPLE_DATA.aspire }
          ];

          state.files = sampleFiles.map((file, index) => ({
            id: Date.now() + index,
            name: file.name,
            size: file.content.length,
            type: file.type,
            content: file.content,
            isSample: true
          }));

          this.updateUI();
          utils.showToast('Sample data loaded successfully', 'success');
        },

        // Update UI after file changes
        updateUI() {
          const uploadArea = $('uploadArea');
          const filePreview = $('filePreview');
          const fileList = $('fileList');
          const runBtn = $('runDemoBtn');
          const runText = $('runDemoText');

          if (!uploadArea || !filePreview || !fileList || !runBtn || !runText) return;

          const hasFiles = state.files.length > 0;

          // Update upload area
          if (hasFiles) {
            uploadArea.classList.add('has-files');
            uploadArea.innerHTML = `
              <div style="font-size: 3rem; margin-bottom: var(--space-md);" aria-hidden="true">✅</div>
              <div style="font-size: var(--font-size-lg); font-weight: 600; margin-bottom: var(--space-sm); color: var(--success);">
                ${state.files.length} file${state.files.length !== 1 ? 's' : ''} ready
              </div>
              <div style="color: var(--neutral-500); font-size: var(--font-size-sm);">
                Click to add more files or drag additional files here
              </div>
            `;
          }

          // Update file preview
          if (hasFiles) {
            filePreview.classList.remove('hidden');
            fileList.innerHTML = state.files.map(file => `
              <div class="file-item">
                <div class="file-info">
                  <div class="file-icon">${file.type.charAt(0)}</div>
                  <div class="file-details">
                    <div class="file-name">${file.name}</div>
                    <div class="file-size">${utils.formatFileSize(file.size)} • ${file.type}</div>
                  </div>
                </div>
                <button onclick="demo.files.removeFile('${file.id}')" 
                        class="btn"
                        style="background: none; color: var(--error); padding: var(--space-xs);"
                        aria-label="Remove ${file.name}">
                  ✕
                </button>
              </div>
            `).join('');
          } else {
            filePreview.classList.add('hidden');
          }

          // Update run button
          runBtn.disabled = !hasFiles || state.processing;
          if (state.processing) {
            runText.textContent = 'Processing...';
          } else if (hasFiles) {
            runText.textContent = '🚀 Run AI Reconciliation';
          } else {
            runText.textContent = 'Upload files to run reconciliation';
          }
        },

        // Remove file
        removeFile(fileId) {
          state.files = state.files.filter(file => file.id !== fileId);
          this.updateUI();
          utils.showToast('File removed', 'info');
        }
      };

      // Demo processing
      const demo = {
        files: files, // Expose files to global scope for onclick handlers

        // Run reconciliation
        async runReconciliation() {
          if (state.processing || state.files.length === 0) return;

          state.processing = true;
          files.updateUI();

          const runLoader = $('runLoader');
          if (runLoader) runLoader.classList.remove('hidden');

          utils.announceToScreenReader('Starting AI reconciliation analysis');

          try {
            // Show progress
            this.showProgress();

            // Simulate processing
            await new Promise(resolve => setTimeout(resolve, 3000));

            // Generate results
            const results = this.generateResults();
            state.results = results;
            this.displayResults(results);

          } catch (error) {
            console.error('Reconciliation error:', error);
            utils.showToast('Processing failed. Please try again.', 'error');
          } finally {
            state.processing = false;
            files.updateUI();
            
            if (runLoader) runLoader.classList.add('hidden');
          }
        },

        // Show processing progress
        showProgress() {
          const demoTool = $('demoTool');
          if (!demoTool) return;

          const progressHtml = `
            <div id="progressSection" class="card" style="margin-bottom: var(--space-xl);">
              <h3 style="font-size: var(--font-size-lg); font-weight: 600; margin-bottom: var(--space-md); text-align: center;">
                AI Processing Your Data
              </h3>
              <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
              </div>
              <p style="text-align: center; color: var(--neutral-600); font-size: var(--font-size-sm);" id="progressText">
                Analyzing transaction patterns...
              </p>
            </div>
          `;

          const resultsSection = $('results');
          if (resultsSection) {
            resultsSection.insertAdjacentHTML('beforebegin', progressHtml);
          }

          // Animate progress
          this.animateProgress();
        },

        // Animate progress bar
        animateProgress() {
          const progressFill = $('progressFill');
          const progressText = $('progressText');
          if (!progressFill || !progressText) return;

          const steps = [
            { progress: 20, text: 'Reading CSV files...' },
            { progress: 40, text: 'Parsing transaction data...' },
            { progress: 60, text: 'Running AI matching algorithms...' },
            { progress: 80, text: 'Calculating accuracy scores...' },
            { progress: 100, text: 'Finalizing results...' }
          ];

          let stepIndex = 0;
          const interval = setInterval(() => {
            if (stepIndex >= steps.length) {
              clearInterval(interval);
              return;
            }

            const step = steps[stepIndex];
            progressFill.style.width = `${step.progress}%`;
            progressText.textContent = step.text;
            stepIndex++;
          }, 600);
        },

        // Generate realistic results
        generateResults() {
          const total = Math.floor(Math.random() * 25) + 20; // 20-45 transactions
          const exactMatches = Math.floor(total * (0.65 + Math.random() * 0.15)); // 65-80%
          const fuzzyMatches = Math.floor((total - exactMatches) * (0.7 + Math.random() * 0.2)); // AI matches
          const unmatched = total - exactMatches - fuzzyMatches;
          const accuracy = Math.round(((exactMatches + fuzzyMatches) / total) * 100);

          return {
            total,
            exactMatches,
            fuzzyMatches,
            unmatched,
            accuracy,
            processingTime: (2.1 + Math.random() * 1.5).toFixed(1),
            potentialRevenue: (exactMatches + fuzzyMatches) * (125 + Math.random() * 200)
          };
        },

        // Display results
        displayResults(results) {
          return utils.safeExecute(() => {
            // Remove progress section
            const progressSection = $('progressSection');
            if (progressSection) {
              progressSection.remove();
            }

            const resultsSection = $('results');
            if (resultsSection) {
              resultsSection.classList.remove('hidden');
              resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // Update subtitle
            const subtitle = $('resultsSubtitle');
            if (subtitle) {
              subtitle.innerHTML = `
                Processed <strong>${results.total}</strong> transactions in <strong>${results.processingTime}s</strong><br>
                <span style="color: var(--accent-green); font-weight: 600;">
                  Found ${Math.round(results.potentialRevenue).toLocaleString()} in potential revenue recovery
                </span>
              `;
            }

            // Animate counters
            setTimeout(() => this.animateCounter('totalTransactions', results.total), 200);
            setTimeout(() => this.animateCounter('exactMatches', results.exactMatches), 400);
            setTimeout(() => this.animateCounter('fuzzyMatches', results.fuzzyMatches), 600);
            setTimeout(() => this.animateCounter('matchAccuracy', results.accuracy, '%'), 800);

            utils.showToast('Reconciliation completed successfully!', 'success');
            utils.announceToScreenReader(`Reconciliation complete. Found ${results.exactMatches} exact matches and ${results.fuzzyMatches} AI matches out of ${results.total} total transactions with ${results.accuracy}% accuracy.`);
          }, 'demo.displayResults');
        },

        // Animate counter
        animateCounter(elementId, target, suffix = '') {
          return utils.safeExecute(() => {
            const el = $(elementId);
            if (!el) return;

            const duration = 1500;
            const start = performance.now();

            function update(timestamp) {
              const elapsed = timestamp - start;
              const progress = Math.min(elapsed / duration, 1);
              const easeOutCubic = 1 - Math.pow(1 - progress, 3);
              const current = Math.floor(target * easeOutCubic);
              
              el.textContent = current.toLocaleString() + suffix;
              
              if (progress < 1) {
                requestAnimationFrame(update);
              }
            }

            requestAnimationFrame(update);
          }, 'demo.animateCounter');
        },

        // Export results
        exportResults() {
          if (!state.results) {
            utils.showToast('No results to export', 'error');
            return;
          }

          return utils.safeExecute(() => {
            const timestamp = new Date().toISOString();
            const csv = [
              ['MedSpaSync Pro - Demo Reconciliation Report'],
              [`Generated: ${timestamp}`],
              [`User: ${state.userEmail || 'Demo User'}`],
              [''],
              ['SUMMARY'],
              [`Total Transactions: ${state.results.total}`],
              [`Exact Matches: ${state.results.exactMatches}`],
              [`AI Fuzzy Matches: ${state.results.fuzzyMatches}`],
              [`Unmatched: ${state.results.unmatched}`],
              [`Overall Accuracy: ${state.results.accuracy}%`],
              [`Processing Time: ${state.results.processingTime}s`],
              [`Potential Revenue Recovery: ${Math.round(state.results.potentialRevenue).toLocaleString()}`],
              [''],
              ['FILES PROCESSED'],
              ...state.files.map(file => [`${file.type}: ${file.name}`])
            ];

            const csvContent = csv.map(row => 
              Array.isArray(row) 
                ? row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
                : `"${String(row).replace(/"/g, '""')}"`
            ).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const filename = `medspasync-demo-${new Date().toISOString().split('T')[0]}.csv`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            utils.showToast('Report exported successfully!', 'success');
            utils.announceToScreenReader('CSV report exported successfully');
          }, 'demo.exportResults');
        },

        // Start over
        startOver() {
          return utils.safeExecute(() => {
            // Reset state
            state.files = [];
            state.processing = false;
            state.results = null;

            // Hide results
            const resultsSection = $('results');
            if (resultsSection) resultsSection.classList.add('hidden');

            // Remove progress section if exists
            const progressSection = $('progressSection');
            if (progressSection) progressSection.remove();

            // Reset upload area
            const uploadArea = $('uploadArea');
            if (uploadArea) {
              uploadArea.classList.remove('has-files');
              uploadArea.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: var(--space-md);" aria-hidden="true">📊</div>
                <div style="font-size: var(--font-size-lg); font-weight: 600; margin-bottom: var(--space-sm); color: var(--neutral-700);">
                  Drop your CSV files here or click to browse
                </div>
                <div style="color: var(--neutral-500); font-size: var(--font-size-sm);">
                  Supports POS, Allé, and Aspire data files
                </div>
              `;
            }

            files.updateUI();
            utils.showToast('Demo reset. Ready for new files.', 'info');
            utils.announceToScreenReader('Demo reset. You can now upload new files to try again.');
          }, 'demo.startOver');
        }
      };

      // Event handlers
      const events = {
        setup() {
          return utils.safeExecute(() => {
            // Hero CTA
            const heroCtaBtn = $('heroCtaBtn');
            if (heroCtaBtn) {
              heroCtaBtn.addEventListener('click', () => {
                sections.show('leadCapture');
              });
            }

            // Lead form
            this.setupLeadForm();

            // File handling
            this.setupFileHandling();

            // Demo controls
            this.setupDemoControls();

            console.log('✅ All event handlers setup complete');
          }, 'events.setup');
        },

        setupLeadForm() {
          const leadForm = $('leadForm');
          if (!leadForm) return;

          leadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const emailEl = $('leadEmail');
            const nameEl = $('leadName');
            
            if (!emailEl) return;
            
            const email = emailEl.value.trim();
            const name = nameEl ? nameEl.value.trim() : '';
            
            // Clear previous errors
            forms.clearError('leadEmail');
            
            if (!email) {
              forms.showError('leadEmail', 'Email address is required');
              return;
            }
            
            if (!utils.validateEmail(email)) {
              forms.showError('leadEmail', 'Please enter a valid email address');
              return;
            }

            // Show loading state
            const submitBtn = leadForm.querySelector('button[type="submit"]');
            const submitText = $('leadSubmitText');
            const loading = submitBtn?.querySelector('.loading');
            
            if (submitText) submitText.textContent = 'Processing...';
            if (loading) loading.classList.remove('hidden');
            if (submitBtn) submitBtn.disabled = true;

            try {
              await forms.submitLead({ email, name });
            } finally {
              if (submitText) submitText.textContent = '🚀 Start Demo';
              if (loading) loading.classList.add('hidden');
              if (submitBtn) submitBtn.disabled = false;
            }
          });

          // Real-time email validation
          const emailInput = $('leadEmail');
          if (emailInput) {
            emailInput.addEventListener('blur', () => {
              const email = emailInput.value.trim();
              if (email && !utils.validateEmail(email)) {
                forms.showError('leadEmail', 'Please enter a valid email address');
              } else if (email) {
                forms.clearError('leadEmail');
              }
            });

            emailInput.addEventListener('input', () => {
              if (emailInput.hasAttribute('aria-invalid') && emailInput.getAttribute('aria-invalid') === 'true') {
                forms.clearError('leadEmail');
              }
            });
          }
        },

        setupFileHandling() {
          const uploadArea = $('uploadArea');
          const fileInput = $('fileInput');
          const loadSampleBtn = $('loadSampleBtn');

          if (!uploadArea || !fileInput) return;

          // Click to upload
          uploadArea.addEventListener('click', () => {
            fileInput.click();
          });

          uploadArea.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              fileInput.click();
            }
          });

          // File input change
          fileInput.addEventListener('change', (e) => {
            const selectedFiles = Array.from(e.target.files);
            selectedFiles.forEach(file => files.addFile(file));
            e.target.value = ''; // Reset input
          });

          // Drag and drop
          this.setupDragAndDrop(uploadArea);

          // Load sample data
          if (loadSampleBtn) {
            loadSampleBtn.addEventListener('click', () => {
              files.loadSampleData();
            });
          }
        },

        setupDragAndDrop(uploadArea) {
          ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, (e) => {
              e.preventDefault();
              e.stopPropagation();
            });
          });

          ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
              uploadArea.classList.add('dragover');
            });
          });

          ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
              uploadArea.classList.remove('dragover');
            });
          });

          uploadArea.addEventListener('drop', (e) => {
            const droppedFiles = Array.from(e.dataTransfer.files);
            droppedFiles.forEach(file => files.addFile(file));
          });
        },

        setupDemoControls() {
          const runDemoBtn = $('runDemoBtn');
          const exportBtn = $('exportBtn');
          const startOverBtn = $('startOverBtn');

          if (runDemoBtn) {
            runDemoBtn.addEventListener('click', () => {
              demo.runReconciliation();
            });
          }

          if (exportBtn) {
            exportBtn.addEventListener('click', () => {
              demo.exportResults();
            });
          }

          if (startOverBtn) {
            startOverBtn.addEventListener('click', () => {
              demo.startOver();
            });
          }
        }
      };

      // Email pre-filling from URL
      const handleEmailPrefill = () => {
        return utils.safeExecute(() => {
          const email = utils.getUrlParameter('email');
          const leadEmailInput = $('leadEmail');
          const leadCaptureSection = $('leadCapture');

          if (email && leadEmailInput) {
            leadEmailInput.value = email;
            
            // If email is provided, skip lead capture and go directly to demo
            if (leadCaptureSection) {
              leadCaptureSection.classList.add('hidden');
              sections.show('demoTool');
            }

            // Store the pre-filled email in state
            state.userEmail = email;

            // Visual indication
            const emailHelp = $('email-help');
            if (emailHelp) {
              emailHelp.innerHTML = `
                <span style="color: var(--accent-green); font-weight: 500;">
                  ✓ Email address provided from previous step
                </span>
              `;
            }

            leadEmailInput.style.background = 'linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%)';
            leadEmailInput.style.borderColor = 'var(--accent-green)';

            utils.announceToScreenReader('Email address has been pre-filled and demo is ready to use.');
            console.log('✅ Email pre-filled from URL parameter:', email);
          }
        }, 'handleEmailPrefill');
      };

      // Error handling
      const setupErrorHandling = () => {
        window.addEventListener('error', (event) => {
          console.error('Global error:', event.error);
          utils.showToast('An unexpected error occurred. Please refresh and try again.', 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
          console.error('Unhandled promise rejection:', event.reason);
          utils.showToast('A processing error occurred. Please try again.', 'error');
        });
      };

      // Performance optimizations
      const optimizations = {
        // Lazy load non-critical resources
        lazyLoadResources() {
          // Load additional fonts if needed
          const fontLink = document.createElement('link');
          fontLink.rel = 'preload';
          fontLink.as = 'font';
          fontLink.type = 'font/woff2';
          fontLink.crossOrigin = 'anonymous';
          
          // Add to head if we had additional fonts
          // document.head.appendChild(fontLink);
        },

        // Optimize images (if any were added)
        optimizeImages() {
          const images = document.querySelectorAll('img');
          images.forEach(img => {
            if (!img.hasAttribute('loading')) {
              img.setAttribute('loading', 'lazy');
            }
          });
        },

        // Service worker registration (for caching)
        registerServiceWorker() {
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
              .then(registration => {
                console.log('SW registered:', registration);
              })
              .catch(registrationError => {
                console.log('SW registration failed:', registrationError);
              });
          }
        }
      };

      // Analytics (placeholder for real implementation)
      const analytics = {
        track(event, properties = {}) {
          console.log('Analytics:', event, properties);
          // Real implementation would send to analytics service
          // gtag('event', event, properties);
        },

        trackPageView() {
          this.track('page_view', {
            page_title: document.title,
            page_location: window.location.href
          });
        },

        trackFileUpload(fileType) {
          this.track('file_upload', {
            file_type: fileType,
            user_email: state.userEmail
          });
        },

        trackDemoComplete(results) {
          this.track('demo_complete', {
            total_transactions: results.total,
            accuracy: results.accuracy,
            processing_time: results.processingTime,
            user_email: state.userEmail
          });
        }
      };

      // Main initialization
      const init = () => {
        console.log('🚀 Initializing MedSpaSync Pro Demo 3.0...');

        try {
          // Hide loading screen
          const loadingScreen = $('loadingScreen');
          if (loadingScreen) {
            setTimeout(() => {
              loadingScreen.classList.add('hidden');
            }, 500);
          }

          // Setup core functionality
          setupErrorHandling();
          events.setup();
          
          // Handle email pre-filling
          handleEmailPrefill();
          
          // Performance optimizations
          optimizations.lazyLoadResources();
          optimizations.optimizeImages();
          
          // Analytics
          analytics.trackPageView();
          
          console.log('✅ Demo initialized successfully');
          utils.showToast('Demo system ready!', 'success', 2000);

        } catch (error) {
          console.error('Initialization error:', error);
          utils.showToast('Failed to initialize demo system. Please refresh the page.', 'error');
        }
      };

      // Expose demo object globally for onclick handlers
      window.demo = demo;

      // DOM ready handler
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }

    })();

    // Service Worker (inline for demo purposes)
    // In production, this would be in a separate sw.js file
    if ('serviceWorker' in navigator) {
      const swCode = `
        const CACHE_NAME = 'medspasync-demo-v1';
        const urlsToCache = [
          '/',
          '/demo.html',
          'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap'
        ];

        self.addEventListener('install', event => {
          event.waitUntil(
            caches.open(CACHE_NAME)
              .then(cache => cache.addAll(urlsToCache))
          );
        });

        self.addEventListener('fetch', event => {
          event.respondWith(
            caches.match(event.request)
              .then(response => {
                if (response) {
                  return response;
                }
                return fetch(event.request);
              }
            )
          );
        });
      `;

      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      
      navigator.serviceWorker.register(swUrl)
        .then(registration => {
          console.log('SW registered successfully');
        })
        .catch(error => {
          console.log('SW registration failed');
        });
    }
  </script>

  <!-- Schema.org structured data for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "MedSpaSync Pro Demo",
    "description": "AI-powered revenue recovery demo for medical spas",
    "applicationCategory": "BusinessApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "127"
    }
  }
  </script>

  <!-- Preload critical resources -->
  <link rel="preload" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='currentColor' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z'/%3E%3C/svg%3E" as="image">

</body>
</html>